# 仕様書：おうちレジ（要件定義）

## 1. 目的
- 子ども向けのレジごっこ体験を提供する。
- 商品情報サービスや決済サービスには接続しない。
- 学習や遊びで直感的に使える操作性を提供する。

## 2. 対象範囲
- 対象デバイスは M5Stack CoreS3 とする。
- 入力手段はバーコード、RFID、タッチ操作を想定する。
- デバッグ時はシリアル入力による疑似操作を受け付ける。
- 出力手段は画面表示と音とする。
- ネットワーク接続は前提としない。

## 3. 用語
- `code`: バーコードから取得する入力値。
- `uid`: RFID から取得する識別子。
- `item`: 商品1件の情報（商品名、価格）。
- `cart`: 会計中の商品一覧。

## 4. 機能要件
### 4.1 通常画面
- アプリ名、商品明細、合計金額、明細消去ボタンを表示する。
- 明細は新しい順に表示する。
- 明細件数には上限を設け、上限超過時は新しい明細を優先する。
- 長い商品名は画面内に収まる形で省略表示する。

### 4.2 バーコード登録
- バーコード入力を受け付け、商品を `cart` に追加する。
- 無効な入力は追加しない。
- バーコードとして扱う入力は6文字以上とする。
- スキャナ制御由来の応答データは商品登録対象から除外する。
- 追加後は合計金額を再計算して画面を更新する。
- 同じ `code` からは常に同じ商品情報を得られること。
- 起動直後およびスキャナ設定適用直後の一時的な不要入力は受け付けない。

### 4.3 RFID 決済
- RFID入力を受け付けると決済完了演出へ遷移する。
- 決済完了演出では購入完了メッセージを表示する。
- 決済完了後は `cart` を空にする。
- 決済完了演出中は新規入力を受け付けない。
- 演出終了後は通常画面へ戻る。

### 4.4 明細消去
- 明細消去ボタン押下で `cart` を空にする。
- 消去後の合計金額は 0 円とする。
- 明細消去時に効果音を再生する。

### 4.5 音の再生
- 起動時、商品登録時、明細消去時、決済時にそれぞれ効果音を再生する。
- 音量と効果音パターンは調整可能とする。

### 4.6 デバッグ操作
- シリアル入力でバーコード登録とRFID決済を疑似実行できること。

### 4.7 バーコードスキャナ運用
- バーコードスキャナはスキャナ本体に備え付けられたボタンを起点に読み取り開始できること。
- 目視しやすい照準状態を維持できること。

## 5. 商品情報要件
- 商品名と価格は `code` から自動決定する。
- 商品名は候補群から決定する。
- 価格はあらかじめ定めた価格帯の範囲内で決定する。
- 金額計算は税計算を行わない単純合算とする。

## 6. 状態要件
- アプリは通常状態と決済完了表示状態を持つ。
- 通常状態では商品登録、決済、明細消去を受け付ける。
- 決済完了表示状態では入力受付を停止する。
- 決済完了表示状態は一定時間後に自動終了する。

## 7. 非機能要件
- 子どもが操作しても誤動作しにくいこと。
- 入力値の妥当性を確認し、異常入力で処理が破綻しないこと。
- 単体で動作し、外部システム停止の影響を受けないこと。

## 8. 受け入れ条件
- 起動直後に通常画面が表示され、明細0件・合計0円であること。
- バーコード入力で商品が追加され、合計金額が更新されること。
- 起動直後およびスキャナ設定適用直後の不要入力では商品が追加されないこと。
- 6文字未満のバーコード入力では商品が追加されないこと。
- スキャナ制御由来の応答データでは商品が追加されないこと。
- 同じ `code` で同じ商品情報が再現されること。
- 明細上限を超える入力時に、新しい明細が優先されること。
- 明細消去ボタンで明細が空になること。
- 明細消去時に効果音が再生されること。
- RFID入力で決済完了演出が表示され、演出後に通常画面へ戻ること。
- 決済完了演出中に追加入力しても会計が重複しないこと。
- シリアル入力でバーコード登録とRFID決済を疑似実行できること。
